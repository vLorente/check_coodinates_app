<div class="validation-form-container">
  <form [formGroup]="validationForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Address Section -->
    <div class="form-section">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900">Dirección</h3>
        
        <!-- Toggle buttons -->
        <div class="flex gap-2 bg-gray-100 rounded-lg p-1">
          <button
            type="button"
            (click)="toggleAddressMode('detailed')"
            [class]="'px-3 py-1 text-sm font-medium rounded-md transition-colors ' +
                     (addressMode() === 'detailed'
                       ? 'bg-white text-gray-900 shadow-sm'
                       : 'text-gray-600 hover:text-gray-900')"
          >
            Detallada
          </button>
          <button
            type="button"
            (click)="toggleAddressMode('single')"
            [class]="'px-3 py-1 text-sm font-medium rounded-md transition-colors ' +
                     (addressMode() === 'single'
                       ? 'bg-white text-gray-900 shadow-sm'
                       : 'text-gray-600 hover:text-gray-900')"
          >
            Una línea
          </button>
        </div>
      </div>

      <!-- Single Line Address -->
      @if (addressMode() === 'single') {
        <div>
          <label for="singleLineAddress" class="block text-sm font-medium text-gray-700 mb-1">
            Dirección completa <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="singleLineAddress"
            formControlName="singleLineAddress"
            placeholder="Ej: Calle Mayor 123, Madrid, 28001, España"
            [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                     (validationForm.get('singleLineAddress')?.invalid && validationForm.get('singleLineAddress')?.touched
                       ? 'border-red-500 focus:ring-red-500'
                       : 'border-gray-300 focus:ring-blue-500')"
          />
          @if (validationForm.get('singleLineAddress')?.invalid && validationForm.get('singleLineAddress')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              @if (validationForm.get('singleLineAddress')?.errors?.['required']) {
                La dirección es obligatoria
              }
              @if (validationForm.get('singleLineAddress')?.errors?.['minlength']) {
                Mínimo 5 caracteres
              }
            </p>
          }
        </div>
      }

      <!-- Detailed Address -->
      @if (addressMode() === 'detailed') {
        <div formGroupName="address" class="space-y-4">
        <!-- Street -->
        <div>
          <label for="street" class="block text-sm font-medium text-gray-700 mb-1">
            Calle <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="street"
            formControlName="street"
            placeholder="Ej: Calle Mayor 123"
            [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                     (addressGroup?.get('street')?.invalid && addressGroup?.get('street')?.touched
                       ? 'border-red-500 focus:ring-red-500'
                       : 'border-gray-300 focus:ring-blue-500')"
          />
          @if (addressGroup?.get('street')?.invalid && addressGroup?.get('street')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              @if (addressGroup?.get('street')?.errors?.['required']) {
                La calle es obligatoria
              }
              @if (addressGroup?.get('street')?.errors?.['minlength']) {
                Mínimo 3 caracteres
              }
            </p>
          }
        </div>

        <!-- City & Postal Code Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- City -->
          <div>
            <label for="city" class="block text-sm font-medium text-gray-700 mb-1">
              Ciudad <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="city"
              formControlName="city"
              placeholder="Ej: Madrid"
              [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                       (addressGroup?.get('city')?.invalid && addressGroup?.get('city')?.touched
                         ? 'border-red-500 focus:ring-red-500'
                         : 'border-gray-300 focus:ring-blue-500')"
            />
            @if (addressGroup?.get('city')?.invalid && addressGroup?.get('city')?.touched) {
              <p class="mt-1 text-sm text-red-600">
                @if (addressGroup?.get('city')?.errors?.['required']) {
                  La ciudad es obligatoria
                }
                @if (addressGroup?.get('city')?.errors?.['minlength']) {
                  Mínimo 2 caracteres
                }
              </p>
            }
          </div>

          <!-- Postal Code -->
          <div>
            <label for="postalCode" class="block text-sm font-medium text-gray-700 mb-1">
              Código Postal <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="postalCode"
              formControlName="postalCode"
              placeholder="28001"
              maxlength="5"
              [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                       (addressGroup?.get('postalCode')?.invalid && addressGroup?.get('postalCode')?.touched
                         ? 'border-red-500 focus:ring-red-500'
                         : 'border-gray-300 focus:ring-blue-500')"
            />
            @if (addressGroup?.get('postalCode')?.invalid && addressGroup?.get('postalCode')?.touched) {
              <p class="mt-1 text-sm text-red-600">
                @if (addressGroup?.get('postalCode')?.errors?.['required']) {
                  El código postal es obligatorio
                }
                @if (addressGroup?.get('postalCode')?.errors?.['pattern']) {
                  Debe tener 5 dígitos
                }
              </p>
            }
          </div>
        </div>

        <!-- Country -->
        <div>
          <label for="country" class="block text-sm font-medium text-gray-700 mb-1">
            País <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="country"
            formControlName="country"
            placeholder="España"
            [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                     (addressGroup?.get('country')?.invalid && addressGroup?.get('country')?.touched
                       ? 'border-red-500 focus:ring-red-500'
                       : 'border-gray-300 focus:ring-blue-500')"
          />
          @if (addressGroup?.get('country')?.invalid && addressGroup?.get('country')?.touched) {
            <p class="mt-1 text-sm text-red-600">El país es obligatorio</p>
          }
        </div>
        </div>
      }
    </div>

    <!-- Coordinates Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Coordenadas</h3>

      <div formGroupName="coordinates" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Latitude -->
        <div>
          <label for="latitude" class="block text-sm font-medium text-gray-700 mb-1">
            Latitud <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="latitude"
            formControlName="latitude"
            placeholder="40.4168"
            [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                     (coordinatesGroup?.get('latitude')?.invalid && coordinatesGroup?.get('latitude')?.touched
                       ? 'border-red-500 focus:ring-red-500'
                       : 'border-gray-300 focus:ring-blue-500')"
          />
          @if (coordinatesGroup?.get('latitude')?.invalid && coordinatesGroup?.get('latitude')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              @if (coordinatesGroup?.get('latitude')?.errors?.['required']) {
                La latitud es obligatoria
              }
              @if (coordinatesGroup?.get('latitude')?.errors?.['pattern']) {
                Formato numérico inválido
              }
              @if (coordinatesGroup?.get('latitude')?.errors?.['latitudeRange']) {
                Debe estar entre -90 y 90
              }
            </p>
          }
        </div>

        <!-- Longitude -->
        <div>
          <label for="longitude" class="block text-sm font-medium text-gray-700 mb-1">
            Longitud <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="longitude"
            formControlName="longitude"
            placeholder="-3.7038"
            [class]="'w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ' +
                     (coordinatesGroup?.get('longitude')?.invalid && coordinatesGroup?.get('longitude')?.touched
                       ? 'border-red-500 focus:ring-red-500'
                       : 'border-gray-300 focus:ring-blue-500')"
          />
          @if (coordinatesGroup?.get('longitude')?.invalid && coordinatesGroup?.get('longitude')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              @if (coordinatesGroup?.get('longitude')?.errors?.['required']) {
                La longitud es obligatoria
              }
              @if (coordinatesGroup?.get('longitude')?.errors?.['pattern']) {
                Formato numérico inválido
              }
              @if (coordinatesGroup?.get('longitude')?.errors?.['longitudeRange']) {
                Debe estar entre -180 y 180
              }
            </p>
          }
        </div>
      </div>
    </div>

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-md">
        <p class="text-sm">{{ errorMessage() }}</p>
      </div>
    }

    <!-- Actions -->
    <div class="flex gap-3">
      <button
        type="submit"
        [disabled]="validationForm.invalid || submitting()"
        [class]="'px-6 py-2 rounded-md font-medium transition-colors ' +
                 (validationForm.invalid || submitting()
                   ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                   : 'bg-blue-600 text-white hover:bg-blue-700')"
      >
        @if (submitting()) {
          <span class="flex items-center gap-2">
            <span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
            Validando...
          </span>
        } @else {
          Validar Coordenadas
        }
      </button>

      <button
        type="button"
        (click)="onClear()"
        [disabled]="submitting()"
        class="px-6 py-2 bg-gray-200 text-gray-700 rounded-md font-medium hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Limpiar
      </button>
    </div>
  </form>
</div>
